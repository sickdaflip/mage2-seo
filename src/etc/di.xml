<?xml version="1.0"?>
<!--
/**
 * FlipDev SEO Extension
 * 
 * @category   FlipDev
 * @package    FlipDev_Seo
 * @author     Philipp Breitsprecher <philippbreitsprecher@gmail.com>
 * @copyright  Copyright (c) 2025 FlipDev
 * @license    MIT
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <!-- Preference for Config Interface -->
    <preference for="FlipDev\Seo\Api\ConfigInterface" type="FlipDev\Seo\Model\Config"/>
    
    <!-- Virtual Types for different logger channels -->
    <virtualType name="FlipDevSeoLogger" type="Magento\Framework\Logger\Monolog">
        <arguments>
            <argument name="name" xsi:type="string">flipdev_seo</argument>
            <argument name="handlers" xsi:type="array">
                <item name="system" xsi:type="object">FlipDevSeoLogHandler</item>
            </argument>
        </arguments>
    </virtualType>
    
    <virtualType name="FlipDevSeoLogHandler" type="Magento\Framework\Logger\Handler\Base">
        <arguments>
            <argument name="fileName" xsi:type="string">/var/log/flipdev_seo.log</argument>
        </arguments>
    </virtualType>
    
    <!-- Inject custom logger into Helper -->
    <type name="FlipDev\Seo\Helper\Data">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <!-- Inject custom logger into all Observers -->
    <type name="FlipDev\Seo\Observer\DefaultProductMeta">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\DefaultCategoryMeta">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\CanonicalProductRedirect">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\CategorySeoHeading">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\DiscontinuedCategoryCheck">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\DiscontinuedProductCheck">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\RemoveMetaKeywords">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\SetAdvancedSearchMetaRobots">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\SetCategoryMetaRobots">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\SetContactMetaDescTitle">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>
    
    <type name="FlipDev\Seo\Observer\SetSearchMetaRobots">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>

    <!-- Inject custom logger into Sitemap Builder -->
    <type name="FlipDev\Seo\Model\XmlSitemap\SitemapBuilder">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>

    <type name="FlipDev\Seo\Cron\GenerateSitemap">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>

    <!-- Inject custom logger into Robots.txt Generator -->
    <type name="FlipDev\Seo\Model\RobotsTxt\Generator">
        <arguments>
            <argument name="logger" xsi:type="object">FlipDevSeoLogger</argument>
        </arguments>
    </type>

    <!-- Register CLI Commands -->
    <type name="Magento\Framework\Console\CommandList">
        <arguments>
            <argument name="commands" xsi:type="array">
                <item name="flipdev_sitemap_generate" xsi:type="object">FlipDev\Seo\Console\Command\GenerateSitemapCommand</item>
                <item name="flipdev_robots_generate" xsi:type="object">FlipDev\Seo\Console\Command\GenerateRobotsCommand</item>
            </argument>
        </arguments>
    </type>
</config>
